{"version":3,"sources":["../../../src/lib/middleware/tokenCheck.js"],"names":["ctx","next","auth","request","headers","user","token","split","jwt","verify","config","jwtSecret","email","User","findByEmail"],"mappings":";;;;;;;;;;;;;;AAAA;;;;AACA;;;;AACA;;;;;;kBAEe;AAAA;AAAA,4FACX,iBAAOA,GAAP,EAAYC,IAAZ;AAAA;;AAAA;AAAA;AAAA;AAAA;AACQC,gCADR,GACeF,IAAIG,OAAJ,CAAYC,OAAZ,CAAoB,eAApB,CADf;;AAAA,gCAGQF,IAHR;AAAA;AAAA;AAAA;;AAIQF,gCAAIG,OAAJ,CAAYE,IAAZ,GAAmB,IAAnB;AAJR,6DAKeJ,MALf;;AAAA;AAAA;AASYK,iCATZ,GASoBJ,KAAKK,KAAL,CAAW,SAAX,EAAsB,CAAtB,CATpB;AAAA,0CAU0BC,uBAAIC,MAAJ,CAAWH,KAAX,EAAkBI,iBAAOC,SAAzB,CAV1B,EAUgBC,KAVhB,eAUgBA,KAVhB;AAAA;AAAA,mCAY2BC,eAAKC,WAAL,CAAiBF,KAAjB,CAZ3B;;AAAA;AAYcP,gCAZd;;AAAA,gCAcYA,IAdZ;AAAA;AAAA;AAAA;;AAeYL,gCAAIG,OAAJ,CAAYE,IAAZ,GAAmB,IAAnB;AAfZ;;AAAA;;AAmBQL,gCAAIG,OAAJ,CAAYE,IAAZ,GAAmBA,IAAnB;AAnBR,6DAoBeJ,MApBf;;AAAA;AAAA;AAAA;;AAuBQD,gCAAIG,OAAJ,CAAYE,IAAZ,GAAmB,IAAnB;;AAvBR;AAAA,6DA0BWJ,MA1BX;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SADW;;AAAA;AAAA;AAAA;AAAA;AAAA,C","file":"tokenCheck.js","sourcesContent":["import User from 'db/models/User';\nimport jwt from 'jsonwebtoken';\nimport config from 'config';\n\nexport default () => \n    async (ctx, next) => {\n        let auth = ctx.request.headers['authorization'];\n\n        if(!auth) {\n            ctx.request.user = null;\n            return next();\n        }\n\n        try{\n            let token = auth.split(\"Bearer \")[1];\n            const { email } = jwt.verify(token, config.jwtSecret);\n\n            const user = await User.findByEmail(email);\n\n            if(!user){\n                ctx.request.user = null;\n                return;\n            }\n\n            ctx.request.user = user;\n            return next();\n\n        } catch(e) {\n            ctx.request.user = null;\n        }\n\n        return next();\n};"]}